!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r(e.xaret={},e.React)}(this,function(e,r){"use strict";function n(e,r){e.at=0,e.doSubscribe(r),e.at=1}function t(e,r,n){if(W(e))return n[r.at++];if(k(e)){for(var i=e,a=0,s=e.length;a<s;++a){var u=e[a],l=u;W(u)?l=n[r.at++]:k(u)&&(l=t(u,r,n)),l!==u&&(i===e&&(i=e.slice(0)),i[a]=l)}return i}return e}function i(e,r,n){var t=null;for(var i in e){var a=e[i];if(W(a)){if(!t){t={};for(var s in e){if(s===i)break;t[s]=e[s]}}t[i]=n[r.at++]}else t&&(t[i]=a)}return t||e}function a(e,r){var n=e.props,a=null,s=null,u=null;e.at=0;for(var l in n){var o=n[l];q===l?u=t(o,e,r):"$$type"===l?a=n[l]:C===l?(s=s||{}).ref=W(o)?r[e.at++]:o:W(o)?(s=s||{})[l]=r[e.at++]:S===l?(s=s||{}).style=i(o,e,r):(s=s||{})[l]=o}return u instanceof Array?E.apply(null,[a,s].concat(u)):null!==u?E(a,s,u):E(a,s)}function s(e,r,n){for(var t=0,i=e.length;t<i;++t){var a=e[t];W(a)?n(r,a):k(a)&&s(a,r,n)}}function u(e,r,n){for(var t in e){var i=e[t];if(W(i))n(r,i);else if(q===t)k(i)&&s(i,r,n);else if(S===t)for(var a in i){var u=i[a];W(u)&&n(r,u)}}}function l(e){e.values+=1}function o(e,r){return function(n){return e({type:r,value:n})}}function f(e){e.subscription.unsubscribe()}function c(e,r){var n=e.pop();n&&f(n,r)}function v(e,r){var n=r.subscribe({next:o(e,j),error:o(e,A),complete:o(e,R)});e.subscription=n}function h(e,r){var n=function r(n){for(var t=e.handlers,i=0;t[i]!==r;)++i;switch(n.type){case j:var a=n.value,s=e.values;s[i]!==a&&(s[i]=a,e.at&&e.forceUpdate());break;case A:throw n.value;default:t[i]=null;var u=t.length;if(u!==e.values.length)return;for(var l=0;l<u;++l)if(t[l])return;e.handlers=null}};e.handlers.push(n),v(n,r)}function d(e,r){for(var n=r.length;e<n;++e){var t=r[e];if(W(t)||k(t)&&d(0,t))return!0}return!1}function p(e){for(var r in e){var n=e[r];if(W(n))return!0;if(q===r){if(k(n)&&d(0,n))return!0}else if(S===r)for(var t in n)if(W(n[t]))return!0}return!1}function b(e,r){var n={$$type:e};for(var t in r){var i=r[t];"ref"===t?n[C]=i:P!==t&&(n[t]=i)}return n}var y=require("infestines"),m=y.array0,x=y.dissocPartialU,g=y.inherit,k=y.isArray,w=y.isString,U=y.object0,$=require("rxjs/Rx"),W=function(e){return e instanceof $.Observable},j="value",A="error",R="end",S="style",q="children",P="xaret-lift",C="$$ref",E=r.createElement,F=r.Component,M=g(function(e){F.call(this,e),this.at=0},F,{componentWillReceiveProps:function(e){this.componentWillUnmount(),n(this,e)},componentWillMount:function(){n(this,this.props)}}),O=g(function(e){M.call(this,e),this.handlers=null,this.rendered=null},M,{componentWillUnmount:function(){var e=this.hanlders.pop();e&&f(e)},doSubscribe:function(e){var r=this,n=e.observable;if(W(n)){var t=function(e){switch(e.type){case j:r.rendered=e.value||null,r.at&&r.forceUpdate();break;case A:throw e.value;case R:r.callback=null}};this.hanlders=t,v(t,n)}else this.rendered=n||null;this.at=1},render:function(){return this.rendered}}),_=g(function(e){M.call(this,e),this.values=this,this.handlers=null},M,{componentWillUnmount:function(){var e=this.handlers;e instanceof Function?u(this.props,e,f):e&&u(this.props,e.reverse(),c)},doSubscribe:function(e){var r=this;this.values=0,u(e,this,l);var n=this.values;switch(n){case 0:this.values=m;break;case 1:this.values=this,u(e,this.handlers=function(e){switch(e.type){case j:var n=e.value;r.values!==n&&(r.values=n,r.at&&r.forceUpdate());break;case A:throw e.value;default:r.values=[r.values],r.handlers=null}},v);break;default:this.values=Array(n).fill(this),this.handlers=[],u(e,this,h)}},render:function(){if(this.handlers instanceof Function){var e=this.values;return e===this?null:a(this,[e])}for(var r=this.values,n=0,t=r.length;n<t;++n)if(r[n]===this)return null;return a(this,r)}});e.fromRx=function(e){return E(O,{observable:e})},e.createElement=function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var t=r[0],i=r[1]||U;return(w(t)||i[P])&&(d(2,r)||p(i)?(r[1]=b(t,i),r[0]=_):i[P]&&(r[1]=x(P,i)||U)),E.apply(void 0,r)},e.fromClass=function(e){return function(r){return E(_,b(e,r))}},Object.defineProperty(e,"__esModule",{value:!0})});
